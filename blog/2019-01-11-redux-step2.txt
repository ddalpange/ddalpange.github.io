0:[[["",{"children":["blog",{"children":[["slug","2019-01-11-redux-step2","d"],{"children":["__PAGE__?{\"slug\":\"2019-01-11-redux-step2\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
3:I{"id":"2070","name":"","chunks":["131:131-718a907043a28311","185:app/layout-ee2bb0ff086a1e28"],"async":false}
4:I{"id":"7131","name":"","chunks":["131:131-718a907043a28311","931:app/page-59d2145bcde12638"],"async":false}
5:I{"id":"830","name":"","chunks":["272:webpack-a84c954fa8715833","776:0b7c6ed9-60e4a7f8e855a262","474:474-c8c5eb3e5e298e46"],"async":false}
6:I{"id":"2079","name":"","chunks":["272:webpack-a84c954fa8715833","776:0b7c6ed9-60e4a7f8e855a262","474:474-c8c5eb3e5e298e46"],"async":false}
1:[["$","html",null,{"lang":"en","data-theme":"retro","children":[["$","head",null,{"children":[["$","link",null,{"rel":"preconnect","href":"https://cdn.jsdelivr.net"}],["$","link",null,{"rel":"stylesheet","type":"text/css","href":"https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"}]]}],["$","body",null,{"className":"flex flex-col items-center h-[100svh]","children":[["$","$L3",null,{"src":"https://www.googletagmanager.com/gtag/js?id=G-XR7V7MF96T","strategy":"afterInteractive"}],["$","$L3",null,{"id":"google-analytics","strategy":"afterInteractive","children":"\n          window.dataLayer = window.dataLayer || [];\n          function gtag(){window.dataLayer.push(arguments);}\n          gtag('js', new Date());\n\n          gtag('config', 'G-XR7V7MF96T');\n        "}],["$","div",null,{"className":"w-full max-w-3xl flex-grow","children":[["$","div",null,{"className":"navbar","children":[["$","div",null,{"className":"flex-1","children":["$","$L4",null,{"className":"p-2 hover:underline md:text-2xl font-bold flex gap-4 items-center","href":"/","children":"Yozzing Blog"}]}],["$","div",null,{"className":"flex-none","children":["$","div",null,{"className":"tabs","children":[["$","$L4",null,{"className":"tab","href":"/engineering","children":"Engineering"}],["$","$L4",null,{"className":"tab","href":"/essay","children":"Essay"}],["$","a",null,{"className":"tab","href":"https://github.com/ddalpange","children":["$","div",null,{"className":"avatar","children":["$","div",null,{"className":"w-8 rounded-full","children":["$","img",null,{"alt":"yozzing","src":"/blog/images/profile.jpeg"}]}]}]}]]}]}]]}],["$","div",null,{"className":"p-4 pb-10","children":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L5",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children",["slug","2019-01-11-redux-step2","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L6",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$L7","$@8"],"segment":"__PAGE__?{\"slug\":\"2019-01-11-redux-step2\"}"}}],"segment":["slug","2019-01-11-redux-step2","d"]}}],"segment":"blog"}}]}]]}]]}]]}],"$@9"]
a:I{"id":"3969","name":"Disqus","chunks":["308:app/blog/[slug]/page-2754d756216a6ffc"],"async":false}
8:[null,null,[]]
9:[null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3127ef311b686118.css","precedence":"next.js"}]]]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"Redux 마스터하기 - 리덕스의 미들웨어에 대하여 알아보자."}],["$","meta",null,{"name":"description","content":"<p><code>Redux</code>는 <code>Action</code>이 <code>Reducer</code>에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. <code>Redux</code>의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자.</p>\n"}],null,[[["$","link",null,{"rel":"author","href":"https://github.io/ddalpange"}],["$","meta",null,{"name":"author","content":"ddalpange"}]]],null,null,["$","meta",null,{"name":"keywords","content":"Redux,Flux"}],null,null,null,["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"any"}]],[],null]]
7:["$","article",null,{"className":"prose max-w-full flex flex-col items-center","children":[["$","span",null,{"className":"mb-2","children":"4년 이상 전"}],["$","h1",null,{"children":"Redux 마스터하기 - 리덕스의 미들웨어에 대하여 알아보자."}],["$","div",null,{"children":["$","div",null,{"className":"prose self-center","children":[["$","p","0",{"children":[["$","code","0",{"children":"Redux"}],"는 ",["$","code","2",{"children":"Action"}],"이 ",["$","code","4",{"children":"Reducer"}],"에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. ",["$","code","6",{"children":"Redux"}],"의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자."]}],"\n",["$","pre","2",{"children":["$","code",null,{"children":"let todoId = 0;\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\n"}]}],"\n",["$","p","4",{"children":[["$","code","0",{"children":"setTimeout"}],"을 걸어 ",["$","code","2",{"children":"Promise"}],"를 반환하는 비동기 작업을 임시로 구현하였다. 위와 같은 비동기 작업이 있을때 ",["$","code","4",{"children":"Redux"}],"의 ",["$","code","6",{"children":"Action"}],"은 어떻게 처리해야 할까?"]}],"\n",["$","h2","6",{"children":"Async / Await"}],"\n",["$","p","8",{"children":["간단하게 ",["$","strong","1",{"children":"Async / Await"}]," 를 이용하여 동기적으로 구현할 수 있을것 같아서 테스트해보았다. 코드는 다음과 같다."]}],"\n",["$","pre","10",{"children":["$","code",null,{"children":"import * as Api from \"./api\";\nexport const addTodo = async text => await Api.addTodo(text);\n"}]}],"\n",["$","p","12",{"children":["돌려보니 ",["$","code","1",{"children":"Actions must be plain objects. Use custom middleware for async actions."}],"라는 에러가 뜨면서 되질 않는다. 액션은 순수한 객체여야 하며 비동기 액션을 위해서는 커스텀 미들웨어를 쓰라는 뜻이다."]}],"\n",["$","h2","14",{"children":"Redux Thunk"}],"\n",["$","p","16",{"children":["대표적으로 많이들 쓰는 ",["$","a","1",{"href":"https://github.com/reduxjs/redux-thunk","children":"redux-thunk"}],"에 대하여 알아보자."]}],"\n",["$","pre","18",{"children":["$","code",null,{"children":"npm install -S redux-thunk\n"}]}],"\n",["$","p","20",{"children":["기존 ",["$","code","1",{"children":"action -> addTodo"}],"는 단순한 ",["$","strong","3",{"children":"객체"}],"를 리턴했지만 이제 비동기를 처리하기 위해 ",["$","strong","5",{"children":"dispatch를 인자로 받고 그에 대한 작업을 promise로 반환하는 함수"}],"를 리턴해야한다.\n",["$","code","7",{"children":"redux-thunk"}],"는 단순히 ",["$","code","9",{"children":"action"}],"에서 반환되어온 함수에 ",["$","code","11",{"children":"dispatch"}],"를 인자로 넣어 실행할 뿐이다. ",["$","code","13",{"children":"redux-thunk"}],"를 적용한 코드는 아래와 같다."]}],"\n",["$","pre","22",{"children":["$","code",null,{"children":"import { createStore, applyMiddleware } from \"redux\";\nimport { addTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nlog(\"before\", store.getState());\nstore.dispatch(addTodo(\"Hello world\")).then(() => {\n  log(\"after\", store.getState());\n});\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `<h1>${label}<h1>`;\n  app.innerHTML += `<pre>${JSON.stringify(json, undefined, 2)}</pre>`;\n}\n"}]}],"\n",["$","pre","24",{"children":["$","code",null,{"children":"import * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(todo => dispatch({ type: \"ADD_TODO\", newTodo: todo }));\n"}]}],"\n",["$","p","26",{"children":[["$","code","0",{"children":"action"}],"이 ",["$","code","2",{"children":"Promise"}],"를 반환한다는거 외에는 크게 달라진점이 없다. 나머지 ",["$","code","4",{"children":"getTodos"}],", ",["$","code","6",{"children":"editTodos"}],", ",["$","code","8",{"children":"removeTodos"}],"도 액션과 리듀서에 추가해보자."]}],"\n",["$","pre","28",{"children":["$","code",null,{"children":"const todos = [\n  {\n    text: \"First Todo\",\n    id: 0,\n    completed: false\n  }\n];\nlet todoId = 1;\nexport const getTodos = () =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve(todos);\n    }, 2000);\n  });\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\nexport const editTodo = newTodo =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      const todoIndex = todos.find(todo => todo.id === newTodo.id);\n      todos[todoIndex] = { ...todos[todoIndex], ...newTodo };\n      resolve(todos[todoIndex]);\n    }, 2000);\n  });\nexport const removeTodo = todoId =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      todos.splice(todos.findIndex(todo => todo.id === todoId));\n      resolve(todoId);\n    }, 2000);\n  });\n"}]}],"\n",["$","pre","30",{"children":["$","code",null,{"children":"import * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(res => dispatch({ type: \"ADD_TODO\", newTodo: res }));\nexport const editTodo = newTodo => dispatch =>\n  Api.editTodo(newTodo).then(res =>\n    dispatch({ type: \"EDIT_TODO\", newTodo: res })\n  );\nexport const removeTodo = todoId => dispatch =>\n  Api.removeTodo(todoId).then(res =>\n    dispatch({ type: \"REMOVE_TODO\", todoId: res })\n  );\nexport const getTodos = () => dispatch =>\n  Api.getTodos().then(res => dispatch({ type: \"GET_TODOS\", todos: res }));\n"}]}],"\n",["$","pre","32",{"children":["$","code",null,{"children":"import { combineReducers } from \"redux\";\nexport default combineReducers({\n  todos: (todos = [], action) => {\n    switch (action.type) {\n      case \"GET_TODOS\":\n        return action.todos;\n      case \"ADD_TODO\":\n        return [...todos, action.newTodo];\n      case \"REMOVE_TODO\":\n        return todos.filter(todo => todo.id !== action.todoId);\n      case \"EDIT_TODO\":\n        const sliced = todos.slice();\n        const index = sliced.findIndex(todo => todo.id === action.newTodo.id);\n        if (index > -1) sliced[index] = action.newTodo;\n        return sliced;\n      default:\n        return todos;\n    }\n  }\n});\n"}]}],"\n",["$","pre","34",{"children":["$","code",null,{"children":"import { createStore, applyMiddleware } from \"redux\";\nimport { addTodo, getTodos, editTodo, removeTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nstart();\nasync function start() {\n  log(\"initial\", store.getState());\n  await store.dispatch(getTodos());\n  log(\"getTodos\", store.getState());\n  await store.dispatch(addTodo(\"Hello Todo!\"));\n  log(\"addTodos\", store.getState());\n  await store.dispatch(\n    editTodo({\n      id: store.getState().todos[0].id,\n      completed: true,\n      text: \"Edited!\"\n    })\n  );\n  log(\"editTodo\", store.getState());\n  await store.dispatch(removeTodo(store.getState().todos[0].id));\n  log(\"removeTodo\", store.getState());\n}\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `<h1>${label}<h1>`;\n  app.innerHTML += `<pre>${JSON.stringify(json, undefined, 2)}</pre>`;\n}\n"}]}],"\n",["$","p","36",{"children":["기본적인 ",["$","code","1",{"children":"CRUD"}]," 작업을 완료하였다. 다음 포스트에서는 ",["$","code","3",{"children":"react"}],"와 ",["$","code","5",{"children":"react-redux"}],"를 이용해 뷰를 만드는 작업을 진행한다.\nCodeSandBox에 예제를 올려두었으니 참고하면 된다."]}],"\n"]}]}],["$","$La",null,{"post":{"title":"Redux 마스터하기 - 리덕스의 미들웨어에 대하여 알아보자.","thumbnail":null,"date":"2019-01-11T18:39:55.000Z","tags":["Redux","Flux"],"categories":["Redux"],"content":"\n`Redux`는 `Action`이 `Reducer`에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. `Redux`의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자.\n\n <!-- more -->\n\n```js api.js\nlet todoId = 0;\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\n```\n\n`setTimeout`을 걸어 `Promise`를 반환하는 비동기 작업을 임시로 구현하였다. 위와 같은 비동기 작업이 있을때 `Redux`의 `Action`은 어떻게 처리해야 할까?\n\n## Async / Await\n\n간단하게 **Async / Await** 를 이용하여 동기적으로 구현할 수 있을것 같아서 테스트해보았다. 코드는 다음과 같다.\n\n```js actions.js\nimport * as Api from \"./api\";\nexport const addTodo = async text => await Api.addTodo(text);\n```\n\n돌려보니 `Actions must be plain objects. Use custom middleware for async actions.`라는 에러가 뜨면서 되질 않는다. 액션은 순수한 객체여야 하며 비동기 액션을 위해서는 커스텀 미들웨어를 쓰라는 뜻이다.\n\n## Redux Thunk\n\n대표적으로 많이들 쓰는 [redux-thunk](https://github.com/reduxjs/redux-thunk)에 대하여 알아보자.\n\n```bash\nnpm install -S redux-thunk\n```\n\n기존 `action -> addTodo`는 단순한 **객체**를 리턴했지만 이제 비동기를 처리하기 위해 **dispatch를 인자로 받고 그에 대한 작업을 promise로 반환하는 함수**를 리턴해야한다.\n`redux-thunk`는 단순히 `action`에서 반환되어온 함수에 `dispatch`를 인자로 넣어 실행할 뿐이다. `redux-thunk`를 적용한 코드는 아래와 같다.\n\n```js index.js\nimport { createStore, applyMiddleware } from \"redux\";\nimport { addTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nlog(\"before\", store.getState());\nstore.dispatch(addTodo(\"Hello world\")).then(() => {\n  log(\"after\", store.getState());\n});\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `<h1>${label}<h1>`;\n  app.innerHTML += `<pre>${JSON.stringify(json, undefined, 2)}</pre>`;\n}\n```\n\n```js actions.js\nimport * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(todo => dispatch({ type: \"ADD_TODO\", newTodo: todo }));\n```\n\n`action`이 `Promise`를 반환한다는거 외에는 크게 달라진점이 없다. 나머지 `getTodos`, `editTodos`, `removeTodos`도 액션과 리듀서에 추가해보자.\n\n```js api.js\nconst todos = [\n  {\n    text: \"First Todo\",\n    id: 0,\n    completed: false\n  }\n];\nlet todoId = 1;\nexport const getTodos = () =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve(todos);\n    }, 2000);\n  });\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\nexport const editTodo = newTodo =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      const todoIndex = todos.find(todo => todo.id === newTodo.id);\n      todos[todoIndex] = { ...todos[todoIndex], ...newTodo };\n      resolve(todos[todoIndex]);\n    }, 2000);\n  });\nexport const removeTodo = todoId =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      todos.splice(todos.findIndex(todo => todo.id === todoId));\n      resolve(todoId);\n    }, 2000);\n  });\n```\n\n```js actions.js\nimport * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(res => dispatch({ type: \"ADD_TODO\", newTodo: res }));\nexport const editTodo = newTodo => dispatch =>\n  Api.editTodo(newTodo).then(res =>\n    dispatch({ type: \"EDIT_TODO\", newTodo: res })\n  );\nexport const removeTodo = todoId => dispatch =>\n  Api.removeTodo(todoId).then(res =>\n    dispatch({ type: \"REMOVE_TODO\", todoId: res })\n  );\nexport const getTodos = () => dispatch =>\n  Api.getTodos().then(res => dispatch({ type: \"GET_TODOS\", todos: res }));\n```\n\n```js reducers.js\nimport { combineReducers } from \"redux\";\nexport default combineReducers({\n  todos: (todos = [], action) => {\n    switch (action.type) {\n      case \"GET_TODOS\":\n        return action.todos;\n      case \"ADD_TODO\":\n        return [...todos, action.newTodo];\n      case \"REMOVE_TODO\":\n        return todos.filter(todo => todo.id !== action.todoId);\n      case \"EDIT_TODO\":\n        const sliced = todos.slice();\n        const index = sliced.findIndex(todo => todo.id === action.newTodo.id);\n        if (index > -1) sliced[index] = action.newTodo;\n        return sliced;\n      default:\n        return todos;\n    }\n  }\n});\n```\n\n```js index.js\nimport { createStore, applyMiddleware } from \"redux\";\nimport { addTodo, getTodos, editTodo, removeTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nstart();\nasync function start() {\n  log(\"initial\", store.getState());\n  await store.dispatch(getTodos());\n  log(\"getTodos\", store.getState());\n  await store.dispatch(addTodo(\"Hello Todo!\"));\n  log(\"addTodos\", store.getState());\n  await store.dispatch(\n    editTodo({\n      id: store.getState().todos[0].id,\n      completed: true,\n      text: \"Edited!\"\n    })\n  );\n  log(\"editTodo\", store.getState());\n  await store.dispatch(removeTodo(store.getState().todos[0].id));\n  log(\"removeTodo\", store.getState());\n}\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `<h1>${label}<h1>`;\n  app.innerHTML += `<pre>${JSON.stringify(json, undefined, 2)}</pre>`;\n}\n```\n\n기본적인 `CRUD` 작업을 완료하였다. 다음 포스트에서는 `react`와 `react-redux`를 이용해 뷰를 만드는 작업을 진행한다.\nCodeSandBox에 예제를 올려두었으니 참고하면 된다.\n\n <iframe src=\"https://codesandbox.io/embed/kmx0w14lo3\" style=\"width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"></iframe>\n","contentHtml":"<p><code>Redux</code>는 <code>Action</code>이 <code>Reducer</code>에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. <code>Redux</code>의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자.</p>\n<pre><code>let todoId = 0;\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\n</code></pre>\n<p><code>setTimeout</code>을 걸어 <code>Promise</code>를 반환하는 비동기 작업을 임시로 구현하였다. 위와 같은 비동기 작업이 있을때 <code>Redux</code>의 <code>Action</code>은 어떻게 처리해야 할까?</p>\n<h2>Async / Await</h2>\n<p>간단하게 <strong>Async / Await</strong> 를 이용하여 동기적으로 구현할 수 있을것 같아서 테스트해보았다. 코드는 다음과 같다.</p>\n<pre><code>import * as Api from \"./api\";\nexport const addTodo = async text => await Api.addTodo(text);\n</code></pre>\n<p>돌려보니 <code>Actions must be plain objects. Use custom middleware for async actions.</code>라는 에러가 뜨면서 되질 않는다. 액션은 순수한 객체여야 하며 비동기 액션을 위해서는 커스텀 미들웨어를 쓰라는 뜻이다.</p>\n<h2>Redux Thunk</h2>\n<p>대표적으로 많이들 쓰는 <a href=\"https://github.com/reduxjs/redux-thunk\">redux-thunk</a>에 대하여 알아보자.</p>\n<pre><code>npm install -S redux-thunk\n</code></pre>\n<p>기존 <code>action -> addTodo</code>는 단순한 <strong>객체</strong>를 리턴했지만 이제 비동기를 처리하기 위해 <strong>dispatch를 인자로 받고 그에 대한 작업을 promise로 반환하는 함수</strong>를 리턴해야한다.\n<code>redux-thunk</code>는 단순히 <code>action</code>에서 반환되어온 함수에 <code>dispatch</code>를 인자로 넣어 실행할 뿐이다. <code>redux-thunk</code>를 적용한 코드는 아래와 같다.</p>\n<pre><code>import { createStore, applyMiddleware } from \"redux\";\nimport { addTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nlog(\"before\", store.getState());\nstore.dispatch(addTodo(\"Hello world\")).then(() => {\n  log(\"after\", store.getState());\n});\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `&#x3C;h1>${label}&#x3C;h1>`;\n  app.innerHTML += `&#x3C;pre>${JSON.stringify(json, undefined, 2)}&#x3C;/pre>`;\n}\n</code></pre>\n<pre><code>import * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(todo => dispatch({ type: \"ADD_TODO\", newTodo: todo }));\n</code></pre>\n<p><code>action</code>이 <code>Promise</code>를 반환한다는거 외에는 크게 달라진점이 없다. 나머지 <code>getTodos</code>, <code>editTodos</code>, <code>removeTodos</code>도 액션과 리듀서에 추가해보자.</p>\n<pre><code>const todos = [\n  {\n    text: \"First Todo\",\n    id: 0,\n    completed: false\n  }\n];\nlet todoId = 1;\nexport const getTodos = () =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve(todos);\n    }, 2000);\n  });\nexport const addTodo = text =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      resolve({\n        text: text,\n        id: todoId++,\n        completed: false\n      });\n    }, 2000);\n  });\nexport const editTodo = newTodo =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      const todoIndex = todos.find(todo => todo.id === newTodo.id);\n      todos[todoIndex] = { ...todos[todoIndex], ...newTodo };\n      resolve(todos[todoIndex]);\n    }, 2000);\n  });\nexport const removeTodo = todoId =>\n  new Promise(resolve => {\n    window.setTimeout(() => {\n      todos.splice(todos.findIndex(todo => todo.id === todoId));\n      resolve(todoId);\n    }, 2000);\n  });\n</code></pre>\n<pre><code>import * as Api from \"./api\";\nexport const addTodo = text => dispatch =>\n  Api.addTodo(text).then(res => dispatch({ type: \"ADD_TODO\", newTodo: res }));\nexport const editTodo = newTodo => dispatch =>\n  Api.editTodo(newTodo).then(res =>\n    dispatch({ type: \"EDIT_TODO\", newTodo: res })\n  );\nexport const removeTodo = todoId => dispatch =>\n  Api.removeTodo(todoId).then(res =>\n    dispatch({ type: \"REMOVE_TODO\", todoId: res })\n  );\nexport const getTodos = () => dispatch =>\n  Api.getTodos().then(res => dispatch({ type: \"GET_TODOS\", todos: res }));\n</code></pre>\n<pre><code>import { combineReducers } from \"redux\";\nexport default combineReducers({\n  todos: (todos = [], action) => {\n    switch (action.type) {\n      case \"GET_TODOS\":\n        return action.todos;\n      case \"ADD_TODO\":\n        return [...todos, action.newTodo];\n      case \"REMOVE_TODO\":\n        return todos.filter(todo => todo.id !== action.todoId);\n      case \"EDIT_TODO\":\n        const sliced = todos.slice();\n        const index = sliced.findIndex(todo => todo.id === action.newTodo.id);\n        if (index > -1) sliced[index] = action.newTodo;\n        return sliced;\n      default:\n        return todos;\n    }\n  }\n});\n</code></pre>\n<pre><code>import { createStore, applyMiddleware } from \"redux\";\nimport { addTodo, getTodos, editTodo, removeTodo } from \"./actions\";\nimport reducers from \"./reducers\";\nimport ReduxThunk from \"redux-thunk\";\nconst store = createStore(reducers, applyMiddleware(ReduxThunk));\nstart();\nasync function start() {\n  log(\"initial\", store.getState());\n  await store.dispatch(getTodos());\n  log(\"getTodos\", store.getState());\n  await store.dispatch(addTodo(\"Hello Todo!\"));\n  log(\"addTodos\", store.getState());\n  await store.dispatch(\n    editTodo({\n      id: store.getState().todos[0].id,\n      completed: true,\n      text: \"Edited!\"\n    })\n  );\n  log(\"editTodo\", store.getState());\n  await store.dispatch(removeTodo(store.getState().todos[0].id));\n  log(\"removeTodo\", store.getState());\n}\nfunction log(label, json) {\n  const app = document.getElementById(\"app\");\n  app.innerHTML += `&#x3C;h1>${label}&#x3C;h1>`;\n  app.innerHTML += `&#x3C;pre>${JSON.stringify(json, undefined, 2)}&#x3C;/pre>`;\n}\n</code></pre>\n<p>기본적인 <code>CRUD</code> 작업을 완료하였다. 다음 포스트에서는 <code>react</code>와 <code>react-redux</code>를 이용해 뷰를 만드는 작업을 진행한다.\nCodeSandBox에 예제를 올려두었으니 참고하면 된다.</p>\n","summary":"<p><code>Redux</code>는 <code>Action</code>이 <code>Reducer</code>에 전해지기 전 해야할 작업을 정의할 수 있는 미들웨어를 지원한다. <code>Redux</code>의 비동기 작업들을 도와주는 미들웨어에 대하여 알아보자.</p>\n","slug":"2019-01-11-redux-step2","link":"/blog/2019-01-11-redux-step2"}}]]}]
