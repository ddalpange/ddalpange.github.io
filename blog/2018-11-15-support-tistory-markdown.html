<!DOCTYPE html><html lang="en" data-theme="retro"><head><meta charSet="utf-8"/><link rel="stylesheet" href="/_next/static/css/6aab0c2b0a3a27f2.css" data-precedence="next.js"/><link rel="preload" as="script" href="https://www.googletagmanager.com/gtag/js?id=G-XR7V7MF96T"/><title>티스토리에서 마크다운 지원하기</title><meta name="description" content="&lt;p&gt;원래 블로그를 hexo로 운영하고 있었는데 아래와 같은 이유때문에 티스토리로 이전했다.&lt;/p&gt;
"/><link rel="author" href="https://github.io/ddalpange"/><meta name="author" content="ddalpange"/><meta name="keywords" content="Markdown,Tistory"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" nomodule=""></script></head><body class="flex flex-col items-center h-[100svh]"><div class="w-full max-w-3xl flex-grow"><div class="navbar bg-base-100"><div class="flex-1"><a class="p-2 hover:underline md:text-2xl font-bold flex gap-4 items-center" href="/">Yozzing Blog</a></div><div class="flex-none"><div class="tabs"><a class="tab" href="/engineering">엔지니어링</a><a class="tab" href="/essay">에세이</a><a class="tab" href="https://github.com/ddalpange"><div class="avatar"><div class="w-8 rounded-full"><img src="/blog/images/profile.jpeg"/></div></div></a></div></div></div><div class="p-4 pb-10"><article class="prose"><h1>티스토리에서 마크다운 지원하기</h1><caption>2018/11/15</caption><div><p>원래 블로그를 hexo로 운영하고 있었는데 아래와 같은 이유때문에 티스토리로 이전했다.</p>
<ul>
<li>이미지를 넣기 매우매우 귀찮다 (일일이 asset폴더에 저장한 후, 경로를 써주어야한다)</li>
<li>hexo 개발환경을 갖추어야한다. (개발환경이 안맞춰진 PC에서는 빌드 및 배포를 할수가 없다)</li>
<li>잡다한 에러가 매우매우 많다.</li>
<li>빌드할때마다 nvm으로 노드 버전을 바꾸어줘야한다.</li>
<li>생각보다 검색 최적화가 이루어지지 않는다. (지킬을 쓸때는 꽤 많이 들어오는 편이었는데. 이상하게 hexo같은 경우는 유입이 거의 없었다.)</li>
</ul>
<p>마크다운을 포기하고 싶지 않았기 때문에. 티스토리에서 마크다운을 지원하게 할 수 있도록 바꾸고싶었다. 구글에 검색해보니 다른 사람들이 작업한 방법은</p>
<ol>
<li>CDN으로 github-markdown.css 를 내려받는다.</li>
<li>별도의 마크다운 편집기를 사용하여 글을 작성한 후. html을 export한다.</li>
</ol>
<p>위 두 과정이었다.
내가 헥소로 넘어온 이유는 이미지를 넣기 귀찮아서인데, 별도의 마크다운 편집기를 사용해야한다면 티스토리를 사용할 이유가 없다. 직접 코드를 작성하기 시작했다.</p>
<ol>
<li>CDN이어야한다. 별도로 js,css파일을 업로드하기 귀찮다.</li>
<li>티스토리편집기의 장점과, 마크다운의 장점을 골고루 혼용할 수 있어야한다.</li>
</ol>
<p>그래서 아래와 같이 코드를 작성하여 기존 티스토리 편집기에서 마크다운을 지원하도록 바꾸었다.
테마 html 편집하기에서 아래 코드를 붙여넣기하면 된다.</p>
<pre><code>&#x3C;!-- css -->
&#x3C;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.css" />
&#x3C;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css" />
&#x3C;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/toolbar/prism-toolbar.min.css" />
&#x3C;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.min.css" />
&#x3C;!-- js -->
&#x3C;script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/toolbar/prism-toolbar.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-markup.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-c.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-typescript.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-scss.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-sass.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-css.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-javascript.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-python.min.js">&#x3C;/script>
&#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-jsx.min.js">&#x3C;/script>
&#x3C;script>
try {
  var article = $(".tt_article_useless_p_margin");
  article[0].className += " markdown-body";
  var childs = article.children();
  var results = [];

  for(var i = 0; i &#x3C; childs.length; i++) {
    var child = childs[i];

    if (child.tagName === "P") {
      if (child.children[0] &#x26;&#x26; child.children[0].tagName === "BR") {
        results.push("");

      } else {
        results.push(child.innerText)

      }
    } else {
      results.push(child);

    }

    child.remove();

  }

  var string = "";

  for (var i = 0; i &#x3C; results.length; i++) {
    var result = results[i];

    if (typeof result === "string") {
      string += result + "\n";

    }  else {
      article.append(marked(string));
      string = "";
      article.append(result);

    }
  }

  if (string) {
    article.append(marked(string));
  }
} catch (e) {
  console.error(e);
}
&#x3C;/script>

</code></pre>
<p>대충 만든 코드를 정리하고 <strong>TOC</strong>를 적용해보자.
<strong>TOC</strong>는 Table of Contents의 줄임말로 목차라고 생각하면 된다.</p>
<p>markedJS에서 렌더러를 통해 마크다운을 엘리먼트로 변환하는 중간 과정에 hook을 걸 수 있다.
h1 ~ h6 엘리먼트에 훅을 걸고 본문의 맨 앞에 <strong>TOC</strong>를 삽입하면 된다.</p>
<pre><code>
var toc = [];
var article = $(".tt_article_useless_p_margin");

prepareTOC(toc);
convert(article);
insertTOC(article, toc);

function insertTOC (article, toc) {
  var result = "목차\n========\n";
  var firstLebel = toc[0] ? toc[0].level : 1;

  for(var i = 0; i &#x3C; toc.length; i++) {
    var link = toc[i];
    var tabs = "";

    for(var j = firstLebel; j &#x3C; link.level; j++) {
      tabs += "\t";
    }

    tabs += "*";
    result += tabs + " ["+ link.text + "](#" + link.anchor + ")\n";
  }
  
  result += "\n\n"
    
   if (toc.length > 2) {
     article.prepend(marked(result));	
   }
}



function convert(article) {

  article[0].className += " markdown-body";
  
  var childs = article.children();
  var results = [];

  for(var i = 0; i &#x3C; childs.length; i++) {

    var child = childs[i];
    if (child.tagName === "P") {
      if (child.children[0] &#x26;&#x26; child.children[0].tagName === "BR") {
        results.push("");
      } else {
        results.push(child.innerText)
      }
    } else {
      results.push(child);
    }

    child.remove();
  }

  var string = "";

  for (var i = 0; i &#x3C; results.length; i++) {
    var result = results[i];
    if (typeof result === "string") {
      string += result + "\n";
    } else {
      article.append(marked(string));
      string = "";
      article.append(result);
    }
  }

  if (string) {
    article.append(marked(string));
  }
}



function prepareTOC(toc) {

  var renderer = new marked.Renderer();

  renderer.heading = function(text, level, raw) {
    var anchor = Math.random() * 100
    toc.push({
      anchor: anchor,
      level: level,
      text: text
    });
    return '&#x3C;h'
      + level
      + ' id="'
      + anchor
      + '">'
      + text
      + '&#x3C;/h'
      + level
      + '>\n';
  };

  marked.setOptions({
    renderer: renderer
  });
}

</code></pre>
<p><a href="https://github.com/markedjs/marked">MarkedJS</a>와 <a href="https://github.com/PrismJS/prism">PrismJS</a>를 사용하였다.</p>
<p>기존 티스토리 편집기에서 마크다운을 붙여넣다보니 다양한 문제들이 있다.</p>
<ol>
<li>포스트 리스트에서 포스트 요약 내용을 마크다운으로 변환할 수 없다. 개행문자를 없앤채로 서버에서 내려오기 때문에 어디서 개행이 되었는지 알 수가 없기 때문.</li>
<li>복붙하는 과정에서 편집기에서는 이상이 없으나, HTML보기를 체크하면 이상한 태그나 CSS가 먹어져 있는 경우가 많다.</li>
<li>마크다운을 고려하지 않은 테마가 있기 때문에, github-markdown.css를 적용하더라도 눈으로 보고 css를 고쳐주어야한다.</li>
<li>글을 작성할 때 마크다운 하이라이팅을 사용할 수 없다.</li>
</ol>
<p>1번의 경우 고객센터를 통해 수정을 요구한 상태인데, 적용이 될지 안될지 모르겠다.</p>
<p>좀 더 사용해보고 문제를 픽스한 후, 오픈소스로 배포할 예정이다</p>
</div></article></div></div><script src="/_next/static/chunks/webpack-b1abe5c771310ce9.js" async=""></script><script src="/_next/static/chunks/0b7c6ed9-5895ea2b955a8219.js" async=""></script><script src="/_next/static/chunks/474-2bfbc4a0bef14471.js" async=""></script><script src="/_next/static/chunks/main-app-658fb0ddf7baceee.js" async=""></script></body></html><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:I{\"id\":\"9638\",\"name\":\"\",\"chunks\":[\"272:webpack-b1abe5c771310ce9\",\"776:0b7c6ed9-5895ea2b955a8219\",\"474:474-2bfbc4a0bef14471\"],\"async\":false}\n4:I{\"id\":\"3644\",\"name\":\"\",\"chunks\":[\"272:webpack-b1abe5c771310ce9\",\"776:0b7c6ed9-5895ea2b955a8219\",\"474:474-2bfbc4a0bef14471\"],\"async\":false}\n6:I{\"id\":\"2070\",\"name\":\"\",\"chunks\":[\"131:131-b649a46ff1b8d8bb\",\"185:app/layout-8083bdbad8f07641\"],\"async\":false}\n7:I{\"id\":\"7131\",\"name\":\"\",\"chunks\":[\"131:131-b649a46ff1b8d8bb\",\"179:app/essay/page-803925d136c9d05d\"],\"async\":false"])</script><script>self.__next_f.push([1,"}\n8:I{\"id\":\"830\",\"name\":\"\",\"chunks\":[\"272:webpack-b1abe5c771310ce9\",\"776:0b7c6ed9-5895ea2b955a8219\",\"474:474-2bfbc4a0bef14471\"],\"async\":false}\n9:I{\"id\":\"2079\",\"name\":\"\",\"chunks\":[\"272:webpack-b1abe5c771310ce9\",\"776:0b7c6ed9-5895ea2b955a8219\",\"474:474-2bfbc4a0bef14471\"],\"async\":false}\n"])</script><script>self.__next_f.push([1,"1:[\"$\",\"$L2\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/2018-11-15-support-tistory-markdown\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2018-11-15-support-tistory-markdown\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"2018-11-15-support-tistory-markdown\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":\"$L3\",\"globalErrorComponent\":\"$4\",\"notFound\":[\"$@5\",[\"$\",\"html\",null,{\"lang\":\"en\",\"data-theme\":\"retro\",\"children\":[\"$\",\"body\",null,{\"className\":\"flex flex-col items-center h-[100svh]\",\"children\":[[\"$\",\"$L6\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-XR7V7MF96T\",\"strategy\":\"afterInteractive\"}],[\"$\",\"$L6\",null,{\"id\":\"google-analytics\",\"strategy\":\"afterInteractive\",\"children\":\"\\n          window.dataLayer = window.dataLayer || [];\\n          function gtag(){window.dataLayer.push(arguments);}\\n          gtag('js', new Date());\\n\\n          gtag('config', 'G-XR7V7MF96T');\\n        \"}],[\"$\",\"div\",null,{\"className\":\"w-full max-w-3xl flex-grow\",\"children\":[[\"$\",\"div\",null,{\"className\":\"navbar bg-base-100\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L7\",null,{\"className\":\"p-2 hover:underline md:text-2xl font-bold flex gap-4 items-center\",\"href\":\"/\",\"children\":\"Yozzing Blog\"}]}],[\"$\",\"div\",null,{\"className\":\"flex-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"tabs\",\"children\":[[\"$\",\"$L7\",null,{\"className\":\"tab\",\"href\":\"/engineering\",\"children\":\"엔지니어링\"}],[\"$\",\"$L7\",null,{\"className\":\"tab\",\"href\":\"/essay\",\"children\":\"에세이\"}],[\"$\",\"a\",null,{\"className\":\"tab\",\"href\":\"https://github.com/ddalpange\",\"children\":[\"$\",\"div\",null,{\"className\":\"avatar\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-8 rounded-full\",\"children\":[\"$\",\"img\",null,{\"src\":\"/blog/images/profile.jpeg\"}]}]}]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"p-4 pb-10\",\"children\":[\"$undefined\",[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]]}]]}]]}]}]],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"data-theme\":\"retro\",\"children\":[\"$\",\"body\",null,{\"className\":\"flex flex-col items-center h-[100svh]\",\"children\":[[\"$\",\"$L6\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-XR7V7MF96T\",\"strategy\":\"afterInteractive\"}],[\"$\",\"$L6\",null,{\"id\":\"google-analytics\",\"strategy\":\"afterInteractive\",\"children\":\"\\n          window.dataLayer = window.dataLayer || [];\\n          function gtag(){window.dataLayer.push(arguments);}\\n          gtag('js', new Date());\\n\\n          gtag('config', 'G-XR7V7MF96T');\\n        \"}],[\"$\",\"div\",null,{\"className\":\"w-full max-w-3xl flex-grow\",\"children\":[[\"$\",\"div\",null,{\"className\":\"navbar bg-base-100\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L7\",null,{\"className\":\"p-2 hover:underline md:text-2xl font-bold flex gap-4 items-center\",\"href\":\"/\",\"children\":\"Yozzing Blog\"}]}],[\"$\",\"div\",null,{\"className\":\"flex-none\",\"children\":[\"$\",\"div\",null,{\"className\":\"tabs\",\"children\":[[\"$\",\"$L7\",null,{\"className\":\"tab\",\"href\":\"/engineering\",\"children\":\"엔지니어링\"}],[\"$\",\"$L7\",null,{\"className\":\"tab\",\"href\":\"/essay\",\"children\":\"에세이\"}],[\"$\",\"a\",null,{\"className\":\"tab\",\"href\":\"https://github.com/ddalpange\",\"children\":[\"$\",\"div\",null,{\"className\":\"avatar\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-8 rounded-full\",\"children\":[\"$\",\"img\",null,{\"src\":\"/blog/images/profile.jpeg\"}]}]}]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"p-4 pb-10\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"2018-11-15-support-tistory-markdown\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$La\",\"$@b\"],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"2018-11-15-support-tistory-markdown\\\"}\"}}],\"segment\":[\"slug\",\"2018-11-15-support-tistory-markdown\",\"d\"]}}],\"segment\":\"blog\"}}]}]]}]]}]}],\"$@c\"]}]\n"])</script><script>self.__next_f.push([1,"5:[null,null,[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/6aab0c2b0a3a27f2.css\",\"precedence\":\"next.js\"}]]]\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"article\",null,{\"className\":\"prose\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"티스토리에서 마크다운 지원하기\"}],[\"$\",\"caption\",null,{\"children\":\"2018/11/15\"}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cp\u003e원래 블로그를 hexo로 운영하고 있었는데 아래와 같은 이유때문에 티스토리로 이전했다.\u003c/p\u003e\\n\u003cul\u003e\\n\u003cli\u003e이미지를 넣기 매우매우 귀찮다 (일일이 asset폴더에 저장한 후, 경로를 써주어야한다)\u003c/li\u003e\\n\u003cli\u003ehexo 개발환경을 갖추어야한다. (개발환경이 안맞춰진 PC에서는 빌드 및 배포를 할수가 없다)\u003c/li\u003e\\n\u003cli\u003e잡다한 에러가 매우매우 많다.\u003c/li\u003e\\n\u003cli\u003e빌드할때마다 nvm으로 노드 버전을 바꾸어줘야한다.\u003c/li\u003e\\n\u003cli\u003e생각보다 검색 최적화가 이루어지지 않는다. (지킬을 쓸때는 꽤 많이 들어오는 편이었는데. 이상하게 hexo같은 경우는 유입이 거의 없었다.)\u003c/li\u003e\\n\u003c/ul\u003e\\n\u003cp\u003e마크다운을 포기하고 싶지 않았기 때문에. 티스토리에서 마크다운을 지원하게 할 수 있도록 바꾸고싶었다. 구글에 검색해보니 다른 사람들이 작업한 방법은\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eCDN으로 github-markdown.css 를 내려받는다.\u003c/li\u003e\\n\u003cli\u003e별도의 마크다운 편집기를 사용하여 글을 작성한 후. html을 export한다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003e위 두 과정이었다.\\n내가 헥소로 넘어온 이유는 이미지를 넣기 귀찮아서인데, 별도의 마크다운 편집기를 사용해야한다면 티스토리를 사용할 이유가 없다. 직접 코드를 작성하기 시작했다.\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003eCDN이어야한다. 별도로 js,css파일을 업로드하기 귀찮다.\u003c/li\u003e\\n\u003cli\u003e티스토리편집기의 장점과, 마크다운의 장점을 골고루 혼용할 수 있어야한다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003e그래서 아래와 같이 코드를 작성하여 기존 티스토리 편집기에서 마크다운을 지원하도록 바꾸었다.\\n테마 html 편집하기에서 아래 코드를 붙여넣기하면 된다.\u003c/p\u003e\\n\u003cpre\u003e\u003ccode\u003e\u0026#x3C;!-- css --\u003e\\n\u0026#x3C;link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.css\\\" /\u003e\\n\u0026#x3C;link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css\\\" /\u003e\\n\u0026#x3C;link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/toolbar/prism-toolbar.min.css\\\" /\u003e\\n\u0026#x3C;link rel=\\\"stylesheet\\\" href=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.min.css\\\" /\u003e\\n\u0026#x3C;!-- js --\u003e\\n\u0026#x3C;script src=\\\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/toolbar/prism-toolbar.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-markup.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-c.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-typescript.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-scss.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-sass.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-css.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-javascript.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-json.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-python.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/components/prism-jsx.min.js\\\"\u003e\u0026#x3C;/script\u003e\\n\u0026#x3C;script\u003e\\ntry {\\n  var article = $(\\\".tt_article_useless_p_margin\\\");\\n  article[0].className += \\\" markdown-body\\\";\\n  var childs = article.children();\\n  var results = [];\\n\\n  for(var i = 0; i \u0026#x3C; childs.length; i++) {\\n    var child = childs[i];\\n\\n    if (child.tagName === \\\"P\\\") {\\n      if (child.children[0] \u0026#x26;\u0026#x26; child.children[0].tagName === \\\"BR\\\") {\\n        results.push(\\\"\\\");\\n\\n      } else {\\n        results.push(child.innerText)\\n\\n      }\\n    } else {\\n      results.push(child);\\n\\n    }\\n\\n    child.remove();\\n\\n  }\\n\\n  var string = \\\"\\\";\\n\\n  for (var i = 0; i \u0026#x3C; results.length; i++) {\\n    var result = results[i];\\n\\n    if (typeof result === \\\"string\\\") {\\n      string += result + \\\"\\\\n\\\";\\n\\n    }  else {\\n      article.append(marked(string));\\n      string = \\\"\\\";\\n      article.append(result);\\n\\n    }\\n  }\\n\\n  if (string) {\\n    article.append(marked(string));\\n  }\\n} catch (e) {\\n  console.error(e);\\n}\\n\u0026#x3C;/script\u003e\\n\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e대충 만든 코드를 정리하고 \u003cstrong\u003eTOC\u003c/strong\u003e를 적용해보자.\\n\u003cstrong\u003eTOC\u003c/strong\u003e는 Table of Contents의 줄임말로 목차라고 생각하면 된다.\u003c/p\u003e\\n\u003cp\u003emarkedJS에서 렌더러를 통해 마크다운을 엘리먼트로 변환하는 중간 과정에 hook을 걸 수 있다.\\nh1 ~ h6 엘리먼트에 훅을 걸고 본문의 맨 앞에 \u003cstrong\u003eTOC\u003c/strong\u003e를 삽입하면 된다.\u003c/p\u003e\\n\u003cpre\u003e\u003ccode\u003e\\nvar toc = [];\\nvar article = $(\\\".tt_article_useless_p_margin\\\");\\n\\nprepareTOC(toc);\\nconvert(article);\\ninsertTOC(article, toc);\\n\\nfunction insertTOC (article, toc) {\\n  var result = \\\"목차\\\\n========\\\\n\\\";\\n  var firstLebel = toc[0] ? toc[0].level : 1;\\n\\n  for(var i = 0; i \u0026#x3C; toc.length; i++) {\\n    var link = toc[i];\\n    var tabs = \\\"\\\";\\n\\n    for(var j = firstLebel; j \u0026#x3C; link.level; j++) {\\n      tabs += \\\"\\\\t\\\";\\n    }\\n\\n    tabs += \\\"*\\\";\\n    result += tabs + \\\" [\\\"+ link.text + \\\"](#\\\" + link.anchor + \\\")\\\\n\\\";\\n  }\\n  \\n  result += \\\"\\\\n\\\\n\\\"\\n    \\n   if (toc.length \u003e 2) {\\n     article.prepend(marked(result));\\t\\n   }\\n}\\n\\n\\n\\nfunction convert(article) {\\n\\n  article[0].className += \\\" markdown-body\\\";\\n  \\n  var childs = article.children();\\n  var results = [];\\n\\n  for(var i = 0; i \u0026#x3C; childs.length; i++) {\\n\\n    var child = childs[i];\\n    if (child.tagName === \\\"P\\\") {\\n      if (child.children[0] \u0026#x26;\u0026#x26; child.children[0].tagName === \\\"BR\\\") {\\n        results.push(\\\"\\\");\\n      } else {\\n        results.push(child.innerText)\\n      }\\n    } else {\\n      results.push(child);\\n    }\\n\\n    child.remove();\\n  }\\n\\n  var string = \\\"\\\";\\n\\n  for (var i = 0; i \u0026#x3C; results.length; i++) {\\n    var result = results[i];\\n    if (typeof result === \\\"string\\\") {\\n      string += result + \\\"\\\\n\\\";\\n    } else {\\n      article.append(marked(string));\\n      string = \\\"\\\";\\n      article.append(result);\\n    }\\n  }\\n\\n  if (string) {\\n    article.append(marked(string));\\n  }\\n}\\n\\n\\n\\nfunction prepareTOC(toc) {\\n\\n  var renderer = new marked.Renderer();\\n\\n  renderer.heading = function(text, level, raw) {\\n    var anchor = Math.random() * 100\\n    toc.push({\\n      anchor: anchor,\\n      level: level,\\n      text: text\\n    });\\n    return '\u0026#x3C;h'\\n      + level\\n      + ' id=\\\"'\\n      + anchor\\n      + '\\\"\u003e'\\n      + text\\n      + '\u0026#x3C;/h'\\n      + level\\n      + '\u003e\\\\n';\\n  };\\n\\n  marked.setOptions({\\n    renderer: renderer\\n  });\\n}\\n\\n\u003c/code\u003e\u003c/pre\u003e\\n\u003cp\u003e\u003ca href=\\\"https://github.com/markedjs/marked\\\"\u003eMarkedJS\u003c/a\u003e와 \u003ca href=\\\"https://github.com/PrismJS/prism\\\"\u003ePrismJS\u003c/a\u003e를 사용하였다.\u003c/p\u003e\\n\u003cp\u003e기존 티스토리 편집기에서 마크다운을 붙여넣다보니 다양한 문제들이 있다.\u003c/p\u003e\\n\u003col\u003e\\n\u003cli\u003e포스트 리스트에서 포스트 요약 내용을 마크다운으로 변환할 수 없다. 개행문자를 없앤채로 서버에서 내려오기 때문에 어디서 개행이 되었는지 알 수가 없기 때문.\u003c/li\u003e\\n\u003cli\u003e복붙하는 과정에서 편집기에서는 이상이 없으나, HTML보기를 체크하면 이상한 태그나 CSS가 먹어져 있는 경우가 많다.\u003c/li\u003e\\n\u003cli\u003e마크다운을 고려하지 않은 테마가 있기 때문에, github-markdown.css를 적용하더라도 눈으로 보고 css를 고쳐주어야한다.\u003c/li\u003e\\n\u003cli\u003e글을 작성할 때 마크다운 하이라이팅을 사용할 수 없다.\u003c/li\u003e\\n\u003c/ol\u003e\\n\u003cp\u003e1번의 경우 고객센터를 통해 수정을 요구한 상태인데, 적용이 될지 안될지 모르겠다.\u003c/p\u003e\\n\u003cp\u003e좀 더 사용해보고 문제를 픽스한 후, 오픈소스로 배포할 예정이다\u003c/p\u003e\\n\"}}]]}]\n"])</script><script>self.__next_f.push([1,"b:[null,null,[]]\nc:[null,null,[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/6aab0c2b0a3a27f2.css\",\"precedence\":\"next.js\"}]]]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"티스토리에서 마크다운 지원하기\"}],[\"$\",\"meta\",null,{\"name\":\"description\",\"content\":\"\u003cp\u003e원래 블로그를 hexo로 운영하고 있었는데 아래와 같은 이유때문에 티스토리로 이전했다.\u003c/p\u003e\\n\"}],null,[[[\"$\",\"link\",null,{\"rel\":\"author\",\"href\":\"https://github.io/ddalpange\"}],[\"$\",\"meta\",null,{\"name\":\"author\",\"content\":\"ddalpange\"}]]],null,null,[\"$\",\"meta\",null,{\"name\":\"keywords\",\"content\":\"Markdown,Tistory\"}],null,null,null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],null,null,null,null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"any\"}]],[],null]]\n"])</script>